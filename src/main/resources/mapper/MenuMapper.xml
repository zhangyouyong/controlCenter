<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper     PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"     "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="menu">
	<select id="getList" resultType="com.bh.entity.BaseMenu" parameterType="map">
		<if test="flag==0">
			SELECT
				bm. NAME,
				bm.node,
				bm.url,
				bm.`level`,
				bm.parent_id
			FROM
				base_menu bm
			WHERE
				bm.type = 1
			AND bm.delete_flag = 0
			AND bm.node REGEXP '^[1][-]{0,1}[0-9]{0,2}[-]{0,1}[0-9]{0,2}[-]{0,1}[0-9]{0,2}$'
		</if>
		<if test="flag==1">
			select DISTINCT * from(
				SELECT
					bm. NAME,
					bm.node,
					bm.url,
					bm.`level`,
					bm.parent_id
				FROM
					base_menu bm,
					user_strategy us
				WHERE
					us.menu_id = bm.menuid
					and us.user_id=#{userId}
				
				union all
				
				SELECT
					bm. NAME,
					bm.node,
					bm.url,
					bm.`level`,
					bm.parent_id
				FROM
					base_menu bm,
					group_strategy gs,
					user_group ug,
					user_group_relation ugr
				WHERE
					bm.menuid = gs.menu_id
				AND gs.group_id = ug.id
				AND ugr.group_id = ug.id
				and ugr.user_id=#{userId}
				) a
				
		</if>
	</select>
</mapper>